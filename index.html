<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Age Manager - Ten Shadows v2</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --ts-bg: #050505;
            --ts-panel: #0f0f0f;
            --ts-border: #222;
            --ts-blood: #8a0000;
            --ts-blood-bright: #ff1a1a;
            --ts-text: #e0e0e0;
            --ts-text-muted: #888;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        body {
            background-color: var(--ts-bg);
            color: var(--ts-text);
            font-family: 'Montserrat', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER --- */
        .app-header {
            height: 60px;
            background: linear-gradient(to right, #000, var(--ts-blood));
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid var(--ts-blood-bright);
            flex-shrink: 0;
            z-index: 100;
        }
        .app-title {
            font-family: 'Cinzel Decorative', cursive;
            font-size: 1.2rem; color: #fff; text-transform: uppercase;
            text-shadow: 0 0 10px var(--ts-blood-bright);
        }

        /* --- LAYOUT PRINCIPAL --- */
        .app-body { display: flex; flex: 1; overflow: hidden; }

        /* ESQUERDA: EDITOR */
        .editor-pane {
            width: 500px; background: var(--ts-panel); border-right: 1px solid var(--ts-border);
            display: flex; flex-direction: column; overflow-y: auto; flex-shrink: 0;
        }
        .editor-section { padding: 20px; border-bottom: 1px solid var(--ts-border); }
        h3 {
            font-size: 0.8rem; text-transform: uppercase; color: var(--ts-blood-bright);
            margin-bottom: 10px; letter-spacing: 1px; display: flex; align-items: center; gap: 8px;
        }

        label { display: block; font-size: 0.75rem; color: var(--ts-text-muted); margin-bottom: 6px; font-weight: 600; }
        
        input, textarea, select {
            width: 100%; background: #000; border: 1px solid var(--ts-border); color: #fff;
            padding: 12px; font-family: monospace; font-size: 0.9rem; border-radius: 4px;
            transition: 0.3s; line-height: 1.4;
        }
        input:focus, textarea:focus, select:focus {
            border-color: var(--ts-blood-bright); box-shadow: 0 0 10px rgba(138, 0, 0, 0.2);
        }
        
        textarea#rpContent { min-height: 350px; resize: vertical; }
        textarea#rpNotes { min-height: 120px; resize: vertical; }

        .shadow-selector-box { display: flex; gap: 10px; }
        .btn-add {
            background: var(--ts-blood); color: #fff; border: none; padding: 0 15px;
            cursor: pointer; border-radius: 4px; font-weight: bold; transition: 0.2s;
        }
        .btn-add:hover { background: var(--ts-blood-bright); }

        .active-list { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .shadow-item {
            background: #1a1a1a; border: 1px solid #333; padding: 8px 12px;
            border-radius: 4px; display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem;
        }
        .shadow-item span { font-weight: bold; color: #ccc; }
        .btn-remove { color: #666; cursor: pointer; transition: 0.2s; }
        .btn-remove:hover { color: var(--ts-blood-bright); }

        .fusion-form { background: #161616; padding: 10px; border-radius: 4px; margin-top: 10px; border: 1px dashed #333; }
        .fusion-row { display: flex; gap: 5px; margin-bottom: 5px; }

        .preview-pane {
            flex: 1; background: #000;
            background-image: radial-gradient(#1a1a1a 1px, transparent 1px); background-size: 20px 20px;
            padding: 20px; overflow-y: auto; display: flex; justify-content: center;
        }

        .action-bar { padding: 15px; display: flex; gap: 10px; background: #000; border-top: 1px solid var(--ts-border); }
        .btn-action {
            flex: 1; padding: 12px; border: none; font-weight: bold; text-transform: uppercase;
            cursor: pointer; border-radius: 4px; font-size: 0.75rem;
        }
        .btn-copy { background: var(--ts-text); color: #000; }
        .btn-copy:hover { background: #fff; }
        .btn-clear { background: transparent; border: 1px solid var(--ts-blood); color: var(--ts-blood); }
        .btn-clear:hover { background: rgba(138,0,0,0.1); }
        .btn-import { background: #222; color: #fff; }

        .import-area { display: none; padding: 10px; background: #222; border-top: 1px solid #444; }
        .import-area.active { display: block; }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(5px);
            z-index: 999; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-box {
            width: 90%; max-width: 400px; background: #0a0a0a; border: 1px solid var(--ts-blood);
            border-radius: 2px; padding: 30px; text-align: center; position: relative;
        }
        .modal-icon { font-size: 3rem; margin-bottom: 20px; display: block; }
        .icon-success { color: #fff; text-shadow: 0 0 10px #fff; }
        .icon-error { color: var(--ts-blood-bright); text-shadow: 0 0 15px var(--ts-blood); }
        .modal-title { font-family: 'Cinzel Decorative', cursive; font-size: 1.5rem; color: #fff; margin-bottom: 10px; }
        .modal-msg { color: #aaa; font-size: 0.9rem; margin-bottom: 25px; }
        .modal-btns { display: flex; gap: 10px; justify-content: center; }
        .modal-btn { padding: 10px 20px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 0.8rem; }
        .m-btn-confirm { background: var(--ts-blood); color: #fff; }
        .m-btn-cancel { background: transparent; border: 1px solid #333; color: #666; }

        /* --- TOAST --- */
        .toast {
            position: fixed; top: 20px; right: 20px; background: var(--ts-blood); color: #fff;
            padding: 10px 20px; border-radius: 4px; font-weight: bold; transform: translateX(200%); transition: 0.3s; z-index: 200;
        }
        .toast.show { transform: translateX(0); }

        @media (max-width: 900px) {
            .app-body { flex-direction: column; overflow: auto; }
            .editor-pane { width: 100%; height: auto; }
            .preview-pane { min-height: 500px; }
            body { overflow: auto; height: auto; }
        }
    </style>
</head>
<body>

    <div id="customModal" class="modal-overlay">
        <div class="modal-box">
            <i id="mIcon" class="fa-solid fa-triangle-exclamation modal-icon"></i>
            <h2 id="mTitle" class="modal-title">Atenção</h2>
            <p id="mMsg" class="modal-msg">Mensagem do sistema.</p>
            <div id="mBtns" class="modal-btns"></div>
        </div>
    </div>

    <div class="app-header">
        <div class="app-title">Golden Age Manager</div>
        <div style="font-size: 0.7rem; color: #666;">Ten Shadows V2</div>
    </div>

    <div class="app-body">
        <div class="editor-pane">
            <div id="importContainer" class="import-area">
                <textarea id="importInput" placeholder="Cole o código HTML aqui..." style="height: 60px;"></textarea>
                <button class="btn-action btn-import" onclick="processImport()" style="width: 100%; margin-top: 5px;">Processar Código</button>
            </div>

            <div class="editor-section">
                <h3><i class="fa-solid fa-heading"></i> Configurações do Cabeçalho</h3>
                <div class="fusion-row">
                    <div style="flex:1">
                        <label>Título Principal</label>
                        <input type="text" id="headerTitle" placeholder="Ten Shadows" oninput="updatePreview()">
                    </div>
                    <div style="flex:1">
                        <label>Subtítulo</label>
                        <input type="text" id="headerSubtitle" placeholder="Chimera Shadow Garden" oninput="updatePreview()">
                    </div>
                </div>
                <div class="fusion-row" style="margin-top: 10px;">
                    <div style="flex:2">
                        <label>Banner URL</label>
                        <input type="text" id="headerBanner" placeholder="https://..." oninput="updatePreview()">
                    </div>
                    <div style="flex:0.5">
                        <label>Kanji</label>
                        <input type="text" id="headerKanji" placeholder="影" maxlength="1" style="text-align:center;" oninput="updatePreview()">
                    </div>
                </div>
            </div>

            <div class="editor-section">
                <h3><i class="fa-solid fa-heart-pulse"></i> Status (Header)</h3>
                <div class="fusion-row">
                    <div style="flex:1">
                        <label>HP Atual</label>
                        <input type="text" id="headHpCur" placeholder="2500" oninput="updatePreview()">
                    </div>
                    <div style="flex:1">
                        <label>HP Max</label>
                        <input type="text" id="headHpMax" placeholder="2500" oninput="updatePreview()">
                    </div>
                </div>
                <div class="fusion-row">
                    <div style="flex:1">
                        <label>EA Atual</label>
                        <input type="text" id="headEaCur" placeholder="100" oninput="updatePreview()">
                    </div>
                    <div style="flex:1">
                        <label>EA Max</label>
                        <input type="text" id="headEaMax" placeholder="2000" oninput="updatePreview()">
                    </div>
                </div>
            </div>

            <div class="editor-section">
                <h3><i class="fa-solid fa-pen-nib"></i> Postagem</h3>
                <label>Narração</label>
                <textarea id="rpContent" oninput="updatePreview()" placeholder="Escreva sua cena aqui..."></textarea>
                <div style="margin-top: 20px;">
                    <label>Nas Sombras (Considerações / Gastos)</label>
                    <textarea id="rpNotes" oninput="updatePreview()" placeholder="Notas off-game, cálculos de dano, etc."></textarea>
                </div>
            </div>

            <div class="editor-section">
                <h3><i class="fa-solid fa-paw"></i> Sombras Padrão</h3>
                <div class="shadow-selector-box">
                    <select id="shadowSelect"></select>
                    <button class="btn-add" onclick="addStandardShadow()"><i class="fa-solid fa-plus"></i></button>
                </div>
                <div id="activeShadowsList" class="active-list"></div>
            </div>

            <div class="editor-section">
                <h3><i class="fa-solid fa-dna"></i> Fusões / Personalizado</h3>
                <div class="fusion-form">
                    <label>Nome</label>
                    <input type="text" id="fusName" placeholder="Ex: Abyss">
                    <div class="fusion-row" style="margin-top: 5px;">
                        <div style="flex:1"><label>HP (Ex: 5000/5000)</label><input type="text" id="fusHp" placeholder="5000"></div>
                        <div style="flex:1"><label>Dano (ATK)</label><input type="text" id="fusAtk" placeholder="100"></div>
                    </div>
                    <label>Imagem URL</label>
                    <input type="text" id="fusImg" placeholder="https://...">
                    <button class="btn-action btn-import" onclick="addFusion()" style="width: 100%; margin-top: 10px;">Adicionar Fusão</button>
                </div>
                <div id="activeFusionsList" class="active-list"></div>
            </div>

            <div class="action-bar">
                <button class="btn-action btn-import" onclick="toggleImportPanel()">Importar</button>
                <button class="btn-action btn-clear" onclick="clearAll()">Limpar</button>
                <button class="btn-action btn-copy" onclick="copyCode()">Copiar Código</button>
            </div>
        </div>

        <div class="preview-pane">
            <div id="previewContainer" style="width: 100%;"></div>
        </div>
    </div>

    <div id="toast" class="toast">Código Copiado!</div>
    <textarea id="hiddenCopy" style="opacity: 0; position: absolute; z-index: -1;"></textarea>

<script>
    // --- MODAL ---
    const modal = document.getElementById('customModal');
    const mIcon = document.getElementById('mIcon');
    const mTitle = document.getElementById('mTitle');
    const mMsg = document.getElementById('mMsg');
    const mBtns = document.getElementById('mBtns');

    function showModal(type, title, msg, onConfirm = null) {
        mTitle.innerText = title;
        mMsg.innerText = msg;
        mBtns.innerHTML = '';
        mIcon.className = 'modal-icon fa-solid';
        if(type === 'error') mIcon.classList.add('fa-circle-exclamation', 'icon-error');
        else if(type === 'success') mIcon.classList.add('fa-circle-check', 'icon-success');
        else mIcon.classList.add('fa-triangle-exclamation', 'icon-warn');

        if(onConfirm) {
            const btnYes = document.createElement('button');
            btnYes.className = 'modal-btn m-btn-confirm';
            btnYes.innerText = 'Confirmar';
            btnYes.onclick = () => { onConfirm(); closeModal(); };
            const btnNo = document.createElement('button');
            btnNo.className = 'modal-btn m-btn-cancel';
            btnNo.innerText = 'Cancelar';
            btnNo.onclick = closeModal;
            mBtns.append(btnNo, btnYes);
        } else {
            const btnOk = document.createElement('button');
            btnOk.className = 'modal-btn m-btn-confirm';
            btnOk.innerText = 'Entendido';
            btnOk.onclick = closeModal;
            mBtns.append(btnOk);
        }
        modal.classList.add('active');
    }

    function closeModal() { modal.classList.remove('active'); }

    // --- DADOS ---
    const shadowDB = {
        "Divine Dogs": { hp: "3.500", atk: "100", img: "https://i.pinimg.com/1200x/40/04/8e/40048e0dee06c7450e5587152721ffc8.jpg" },
        "Touro": { hp: "8.500", atk: "200 (Base)", img: "https://i.pinimg.com/1200x/8b/1b/83/8b1b836bc53bc298d94f9471b21a208f.jpg" },
        "Nue": { hp: "4.500", atk: "150", img: "https://i.pinimg.com/1200x/aa/c8/f3/aac8f3abcbfabed5989e73f200eb7b28.jpg" },
        "Orochi": { hp: "5.500", atk: "200", img: "https://i.pinimg.com/1200x/e2/9c/88/e29c882bc2d9015d5e69f476b030bcd6.jpg" },
        "Gama": { hp: "3.500", atk: "50", img: "https://i.pinimg.com/1200x/9d/8f/db/9d8fdb8da1d68d404ba978b53190ccbd.jpg" },
        "Koso": { hp: "5.000", atk: "200", img: "https://i.pinimg.com/736x/95/c2/17/95c2175d580e1f17f2a0cd57045eaf20.jpg" },
        "Bansho": { hp: "12.000", atk: "600", img: "https://i.pinimg.com/736x/c1/44/24/c1442460192124d74cf9b82e96da0e4a.jpg" },
        "Datsuto": { hp: "1", atk: "0", img: "https://i.pinimg.com/736x/da/51/94/da519447b4d25c28265fa496b3fe5507.jpg" },
        "Madoka": { hp: "6.000", atk: "0", img: "https://i.pinimg.com/736x/33/bf/a0/33bfa0d908ce561cbfc75e851cac041a.jpg" },
        "Mahoraga": { hp: "80.000", atk: "1.000", img: "https://i.pinimg.com/736x/2b/02/4d/2b024df405bf6b1a19524f3a1fe643c9.jpg" }
    };

    let state = {
        title: "Ten Shadows",
        subtitle: "Chimera Shadow Garden",
        banner: "https://i.imgur.com/rN76FYb.png",
        kanji: "影",
        headHpCur: "2500", headHpMax: "2500",
        headEaCur: "100", headEaMax: "2000",
        rp: "",
        notes: "",
        activeShadows: [],
        fusions: []
    };

    function init() {
        const select = document.getElementById('shadowSelect');
        for (const key in shadowDB) {
            const opt = document.createElement('option');
            opt.value = key; opt.innerText = key; select.appendChild(opt);
        }
        loadCache();
    }

    function addStandardShadow() {
        state.activeShadows.push(document.getElementById('shadowSelect').value);
        renderLists(); updatePreview(); saveCache();
    }

    function removeStandardShadow(index) {
        state.activeShadows.splice(index, 1);
        renderLists(); updatePreview(); saveCache();
    }

    function addFusion() {
        const name = document.getElementById('fusName').value;
        const hp = document.getElementById('fusHp').value;
        const atk = document.getElementById('fusAtk').value;
        const img = document.getElementById('fusImg').value;
        if(!name || !img) { showModal('error', 'Erro', 'Preencha Nome e Imagem.'); return; }
        
        // Auto-formatação para barra de progresso se o user digitar só um número
        let finalHp = hp;
        if(hp && !hp.includes('/')) {
            finalHp = `${hp}/${hp}`;
        }

        state.fusions.push({ name, hp: finalHp, atk, img });
        ['fusName','fusHp','fusAtk','fusImg'].forEach(id => document.getElementById(id).value = "");
        renderLists(); updatePreview(); saveCache();
    }

    function removeFusion(index) {
        state.fusions.splice(index, 1);
        renderLists(); updatePreview(); saveCache();
    }

    function renderLists() {
        const listStd = document.getElementById('activeShadowsList');
        listStd.innerHTML = '';
        state.activeShadows.forEach((key, index) => {
            const div = document.createElement('div');
            div.className = 'shadow-item';
            div.innerHTML = `<span>${key}</span> <i class="fa-solid fa-trash btn-remove" onclick="removeStandardShadow(${index})"></i>`;
            listStd.appendChild(div);
        });

        const listFus = document.getElementById('activeFusionsList');
        listFus.innerHTML = '';
        state.fusions.forEach((fus, index) => {
            const div = document.createElement('div');
            div.className = 'shadow-item';
            div.innerHTML = `<span>${fus.name}</span> <i class="fa-solid fa-trash btn-remove" onclick="removeFusion(${index})"></i>`;
            listFus.appendChild(div);
        });
    }

    function updatePreview() {
        state.title = document.getElementById('headerTitle').value || "Ten Shadows";
        state.subtitle = document.getElementById('headerSubtitle').value || "Chimera Shadow Garden";
        state.banner = document.getElementById('headerBanner').value || "https://i.imgur.com/rN76FYb.png";
        state.kanji = document.getElementById('headerKanji').value || "影";
        
        state.headHpCur = document.getElementById('headHpCur').value || "0";
        state.headHpMax = document.getElementById('headHpMax').value || "0";
        state.headEaCur = document.getElementById('headEaCur').value || "0";
        state.headEaMax = document.getElementById('headEaMax').value || "0";

        state.rp = document.getElementById('rpContent').value;
        state.notes = document.getElementById('rpNotes').value; 

        let formattedRP = state.rp.replace(/\n/g, '<br>').replace(/\[b\]/g, '<b>').replace(/\[\/b\]/g, '</b>').replace(/\[i\]/g, '<i>').replace(/\[\/i\]/g, '</i>');
        if(!formattedRP) formattedRP = "<p>Escreva sua narração...</p>";
        else formattedRP = `<p>${formattedRP}</p>`;

        let formattedNotes = state.notes.replace(/\n/g, '<br>').replace(/\[b\]/g, '<b>').replace(/\[\/b\]/g, '</b>').replace(/\[i\]/g, '<i>').replace(/\[\/i\]/g, '</i>');
        if(!formattedNotes) formattedNotes = "Insira suas considerações aqui.";

        // GERAR HTML DOS CARDS (COM BARRAS)
        let shadowsHTML = '';
        
        // Padrões (BD)
        state.activeShadows.forEach(key => {
            const s = shadowDB[key];
            // Para cards padrão, assumimos HP cheio (ex: 3.500/3.500)
            const hpFormatted = `${s.hp}/${s.hp}`;
            
            shadowsHTML += `
            <div class="mz-card">
                <img src="${s.img}" class="mz-card-icon">
                <div class="mz-card-stats">
                    <span class="mz-cs-name">${key}</span>
                    <div class="mz-cs-val">
                        HP: <span class="mz-hp-val">${hpFormatted}</span>
                    </div>
                    <div class="mz-bar-track"><div class="mz-hp-fill"></div></div>
                    <div class="mz-cs-val">ATK: <span>${s.atk}</span></div>
                </div>
            </div>`;
        });

        // Personalizados
        state.fusions.forEach(fus => {
            // Garantir formato barra
            let hpShow = fus.hp;
            if(!hpShow.includes('/')) hpShow = `${hpShow}/${hpShow}`;

            shadowsHTML += `
            <div class="mz-card">
                <img src="${fus.img}" class="mz-card-icon">
                <div class="mz-card-stats">
                    <span class="mz-cs-name">${fus.name}</span>
                    <div class="mz-cs-val">
                        HP: <span class="mz-hp-val">${hpShow}</span>
                    </div>
                    <div class="mz-bar-track"><div class="mz-hp-fill"></div></div>
                    <div class="mz-cs-val">ATK: <span>${fus.atk}</span></div>
                </div>
            </div>`;
        });

        // CSS ADICIONAL PARA AS BARRAS (INJETADO PARA GARANTIR FUNCIONAMENTO)
        const barCSS = `
<style>
/* --- STATUS DO HEADER --- */
.mz-header-stats { margin-top: 18px; width: 100%; max-width: 280px; display: flex; flex-direction: column; gap: 8px; }
.mz-stat-row { display: flex; flex-direction: column; position: relative; }
.mz-stat-info { display: flex; justify-content: space-between; font-family: 'Montserrat', sans-serif; font-size: 0.75em; color: #ccc; margin-bottom: 2px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
.mz-header-track { width: 100%; height: 6px; background: rgba(0,0,0,0.6); border: 1px solid #444; border-radius: 2px; overflow: hidden; box-shadow: inset 0 0 5px rgba(0,0,0,0.8); }
.mz-header-hp-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--mz-blood), var(--mz-blood-bright)); box-shadow: 0 0 10px var(--mz-blood); transition: width 0.6s cubic-bezier(0.25, 1, 0.5, 1); }
.mz-header-ea-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #cc8800, #ffcc00); box-shadow: 0 0 10px #cc8800; transition: width 0.6s cubic-bezier(0.25, 1, 0.5, 1); }

/* --- BARRAS DOS CARDS --- */
.mz-bar-track { width: 100%; height: 4px; background: rgba(0,0,0,0.8); border: 1px solid #333; margin-top: 2px; margin-bottom: 5px; position: relative; overflow: hidden; }
.mz-hp-fill { height: 100%; width: 0%; background: var(--mz-blood-bright); box-shadow: 0 0 5px var(--mz-blood); transition: width 0.5s ease-in-out; }
</style>`;

        // TEMPLATE FINAL
        const template = `<link href="https://goldenagerpg.github.io/templates.io/meredith-post.css" rel="stylesheet">${barCSS}
<div class="mz-post-container">
    
    <div class="mz-header">
        <div class="mz-header-bg" style="background-image: url('${state.banner}');"></div>
        
        <div class="mz-titles-box">
            <div class="mz-main-title">${state.title}</div>
            <div class="mz-sub-title">${state.subtitle}</div>

            <div class="mz-header-stats">
                <div class="mz-stat-row">
                    <div class="mz-stat-info">
                        <span>HP</span>
                        <span class="mz-header-hp-val">${state.headHpCur}/${state.headHpMax}</span>
                    </div>
                    <div class="mz-header-track"><div class="mz-header-hp-fill"></div></div>
                </div>
                <div class="mz-stat-row">
                    <div class="mz-stat-info">
                        <span>EA</span>
                        <span class="mz-header-ea-val">${state.headEaCur}/${state.headEaMax}</span>
                    </div>
                    <div class="mz-header-track"><div class="mz-header-ea-fill"></div></div>
                </div>
            </div>
            </div>

        <div class="mz-avatar-box">
            <div class="mz-symbol">${state.kanji}</div>
        </div>
    </div>

    <div class="mz-content">${formattedRP}</div>

    <div class="mz-notes-container">
        <div class="mz-notes-content">${formattedNotes}</div>
    </div>

    <div class="mz-shadows-deck">${shadowsHTML}</div>

    <div class="mz-signature"></div>
</div>`;

        document.getElementById('previewContainer').innerHTML = template;
        document.getElementById('hiddenCopy').value = template;
        saveCache();
    }

    function toggleImportPanel() { document.getElementById('importContainer').classList.toggle('active'); }

    function processImport() {
        const code = document.getElementById('importInput').value;
        if (!code) { showModal('error', 'Erro', 'Campo vazio.'); return; }
        try {
            const parser = new DOMParser();
            const doc = parser.parseFromString(code, 'text/html');
            
            // Header
            const titleEl = doc.querySelector('.mz-main-title');
            if(titleEl) document.getElementById('headerTitle').value = titleEl.innerText;
            const subEl = doc.querySelector('.mz-sub-title');
            if(subEl) document.getElementById('headerSubtitle').value = subEl.innerText;
            const kanjiEl = doc.querySelector('.mz-symbol');
            if(kanjiEl) document.getElementById('headerKanji').value = kanjiEl.innerText;
            
            const bgDiv = doc.querySelector('.mz-header-bg');
            if(bgDiv && bgDiv.style.backgroundImage) {
                const url = bgDiv.style.backgroundImage.replace(/url\(['"]?(.*?)['"]?\)/, '$1');
                document.getElementById('headerBanner').value = url;
            }

            // Header Stats Import
            const hpVal = doc.querySelector('.mz-header-hp-val');
            if(hpVal) {
                const parts = hpVal.innerText.split('/');
                document.getElementById('headHpCur').value = parts[0].trim();
                document.getElementById('headHpMax').value = parts[1] ? parts[1].trim() : parts[0].trim();
            }
            const eaVal = doc.querySelector('.mz-header-ea-val');
            if(eaVal) {
                const parts = eaVal.innerText.split('/');
                document.getElementById('headEaCur').value = parts[0].trim();
                document.getElementById('headEaMax').value = parts[1] ? parts[1].trim() : parts[0].trim();
            }

            // Conteúdo
            let contentDiv = doc.querySelector('.mz-content');
            if (contentDiv) document.getElementById('rpContent').value = contentDiv.innerHTML.replace(/<p>/g, '').replace(/<\/p>/g, '').replace(/<br\s*\/?>/gi, '\n').trim();
            
            let notesDiv = doc.querySelector('.mz-notes-content');
            if (notesDiv) document.getElementById('rpNotes').value = notesDiv.innerHTML.replace(/<br\s*\/?>/gi, '\n').trim();

            // Cards
            state.activeShadows = []; state.fusions = [];
            const cards = doc.querySelectorAll('.mz-card');
            cards.forEach(card => {
                const name = card.querySelector('.mz-cs-name').innerText;
                const img = card.querySelector('img').src;
                
                // Checar se é padrão
                let isStandard = shadowDB[name] ? true : false;
                
                if(isStandard) {
                    state.activeShadows.push(name);
                } else {
                    // Custom
                    // Tentar achar o HP val
                    const hpEl = card.querySelector('.mz-hp-val');
                    const atkEls = card.querySelectorAll('.mz-cs-val span'); 
                    // ATK é geralmente o último span se tiver estrutura nova, ou o segundo se antiga
                    // Vamos tentar pegar pelo contexto
                    let hpTxt = hpEl ? hpEl.innerText : (atkEls[0]?.innerText || '?');
                    let atkTxt = atkEls[atkEls.length - 1]?.innerText || '?';

                    state.fusions.push({ name, img, hp: hpTxt, atk: atkTxt });
                }
            });
            
            renderLists(); updatePreview(); toggleImportPanel(); showModal('success', 'Sucesso', 'Importado!');
        } catch (e) { console.log(e); showModal('error', 'Erro', 'Código inválido.'); }
    }

    function copyCode() {
        updatePreview();
        const copyText = document.getElementById("hiddenCopy");
        copyText.select();
        document.execCommand("copy");
        const t = document.getElementById('toast');
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    function clearAll() {
        showModal('confirm', 'Limpar Tudo?', 'Tem certeza?', () => {
            state = { 
                title: "Ten Shadows", subtitle: "Chimera Shadow Garden", banner: "https://i.imgur.com/rN76FYb.png", kanji: "影", 
                headHpCur: "2500", headHpMax: "2500", headEaCur: "100", headEaMax: "2000",
                rp: "", notes: "", activeShadows: [], fusions: [] 
            };
            ['rpContent','rpNotes','headerTitle','headerSubtitle','headerBanner','headerKanji', 'headHpCur', 'headHpMax', 'headEaCur', 'headEaMax'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.value = "";
            });
            renderLists(); updatePreview(); localStorage.removeItem('ga_ts_manager_v2');
        });
    }

    function saveCache() { localStorage.setItem('ga_ts_manager_v2', JSON.stringify(state)); }
    function loadCache() {
        const data = JSON.parse(localStorage.getItem('ga_ts_manager_v2'));
        if (data) {
            state = data;
            document.getElementById('rpContent').value = state.rp || "";
            document.getElementById('rpNotes').value = state.notes || "";
            document.getElementById('headerTitle').value = state.title || "";
            document.getElementById('headerSubtitle').value = state.subtitle || "";
            document.getElementById('headerBanner').value = state.banner || "";
            document.getElementById('headerKanji').value = state.kanji || "";
            
            document.getElementById('headHpCur').value = state.headHpCur || "";
            document.getElementById('headHpMax').value = state.headHpMax || "";
            document.getElementById('headEaCur').value = state.headEaCur || "";
            document.getElementById('headEaMax').value = state.headEaMax || "";

            renderLists(); updatePreview();
        }
    }

    init();
</script>
</body>
</html>
